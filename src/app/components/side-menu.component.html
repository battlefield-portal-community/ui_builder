<div class="side-menu">
  <div class="menu-header">
    <h3>UI Builder</h3>
  </div>

  <!-- Canvas Background -->
  <div class="menu-section">
    <h4>Canvas Background</h4>
    <div class="background-mode-options">
      <label class="background-mode-option">
        <input
          type="radio"
          name="canvas-background-mode"
          [checked]="backgroundMode() === 'black'"
          (change)="setBackgroundMode('black')"
        />
        <span class="background-mode-label">
          <span class="mode-swatch mode-swatch--black"></span>
          Black
        </span>
      </label>
      <label class="background-mode-option">
        <input
          type="radio"
          name="canvas-background-mode"
          [checked]="backgroundMode() === 'white'"
          (change)="setBackgroundMode('white')"
        />
        <span class="background-mode-label">
          <span class="mode-swatch mode-swatch--white"></span>
          White
        </span>
      </label>
      <label class="background-mode-option">
        <input
          type="radio"
          name="canvas-background-mode"
          [checked]="backgroundMode() === 'image'"
          (change)="setBackgroundMode('image')"
        />
        <span class="background-mode-label">
          <span class="mode-swatch mode-swatch--image"></span>
          Image
        </span>
      </label>
    </div>

    @if (backgroundMode() === 'image') {
      <div class="background-image-picker">
        <label class="background-upload">
          <input
            class="background-upload__input"
            type="file"
            accept="image/*"
            multiple
            (change)="onBackgroundImageUpload($event)"
          />
          <span class="background-upload__icon">‚¨ÜÔ∏è</span>
          <span class="background-upload__text">Upload background image</span>
        </label>

        <div
          class="background-image-grid"
          [class.background-image-grid--empty]="backgroundImages().length === 0"
        >
          <button
            type="button"
            class="background-image-tile"
            [class.selected]="isBackgroundImageSelected(defaultBackgroundImage.id)"
            (click)="setBackgroundImage(defaultBackgroundImage.id)"
            [title]="defaultBackgroundImage.fileName"
          >
            <span class="background-image-badge">Default</span>
            <span
              class="background-image-preview"
              [style.background-image]="'url(' + defaultBackgroundImage.url + ')'"
            ></span>
            <span class="background-image-label">{{defaultBackgroundImage.label}}</span>
          </button>

          @for (image of backgroundImages(); track image.id) {
            <button
              type="button"
              class="background-image-tile"
              [class.selected]="isBackgroundImageSelected(image.id)"
              (click)="setBackgroundImage(image.id)"
              [title]="image.fileName"
            >
              <span
                class="background-image-preview"
                [style.background-image]="'url(' + image.url + ')'"
              ></span>
              <span class="background-image-label">{{image.label}}</span>
            </button>
          }
        </div>

        @if (backgroundImages().length === 0) {
          <div class="background-empty">
            Uploaded images will appear here. You can also reference assets by path in the service.
          </div>
        }
      </div>
    } @else {
      <div class="background-solid-preview">
        <span
          class="solid-preview"
          [class.solid-preview--black]="backgroundMode() === 'black'"
          [class.solid-preview--white]="backgroundMode() === 'white'"
        ></span>
        <span class="solid-preview-label">{{backgroundMode() | titlecase}} background active</span>
      </div>
    }
  </div>

  <!-- Add Element Section -->
  <div class="menu-section">
    <h4>Add Element</h4>
    <div class="element-types">
      @for (type of elementTypes; track type) {
        <button 
          class="element-type-btn"
          (click)="addElement(type)"
          [title]="'Add ' + type + (selectedElement() ? ' to ' + selectedElement()?.name : ' to root')"
        >
          <span class="element-icon">{{getElementIcon(type)}}</span>
          <span class="element-label">{{type}}</span>
        </button>
      }
    </div>
    <div class="add-info">
      @if (selectedElement(); as selected) {
        <span class="add-target">Adding to: <strong>{{selected.name}}</strong></span>
      } @else {
        <span class="add-target">Adding to: <strong>Root</strong></span>
      }
    </div>
  </div>

  <!-- Snapping -->
  <div class="menu-section">
    <h4>Snapping</h4>
    <div class="snap-toggle">
      <label class="snap-toggle__label">
        <input
          type="checkbox"
          [checked]="snapToElements()"
          (change)="setSnapToElements($any($event.target).checked)"
        />
        <span>Snap to nearby elements</span>
      </label>
      <p class="snap-toggle__hint">
        Aligns edges and centers while dragging elements within the same container.
      </p>
    </div>
  </div>

  <!-- Element Hierarchy -->
  <div class="menu-section">
    <h4>Element Hierarchy</h4>
    <div class="element-tree">
      @if (elements().length === 0) {
        <div class="empty-state">No elements yet</div>
      } @else {
        @for (item of getFlattenedElements(); track item.element.id) {
          <div class="tree-element" [class.selected]="item.element.id === selectedElementId()">
            <div 
              class="element-item"
              (click)="selectElement(item.element.id)"
              [style.padding-left.px]="item.level * 20"
            >
              <span class="child-indicator">{{getIndentIndicator(item.level)}}</span>
              <span class="element-icon">{{getElementIcon(item.element.type)}}</span>
              <span class="element-name">{{item.element.name}}</span>
              <div class="element-actions">
                <button
                  class="action-btn move-btn"
                  (click)="moveElement($event, item.element.id, 'up')"
                  [disabled]="!canMove(item.element, 'up')"
                  title="Move up"
                >‚¨ÜÔ∏è</button>
                <button
                  class="action-btn move-btn"
                  (click)="moveElement($event, item.element.id, 'down')"
                  [disabled]="!canMove(item.element, 'down')"
                  title="Move down"
                >‚¨áÔ∏è</button>
                <button 
                  class="action-btn delete-btn"
                  (click)="deleteElement($event, item.element.id)"
                  title="Delete element"
                >
                  üóëÔ∏è
                </button>
              </div>
            </div>
          </div>
        }
      }
    </div>
  </div>

  <!-- Actions -->
  <div class="menu-section">
    <h4>Actions</h4>
    <div class="actions">
      <button 
        class="action-button duplicate-btn"
        (click)="duplicateSelectedElement()"
        [disabled]="!selectedElementId()"
      >
        üìã Duplicate selected element
      </button>
      <button 
        class="action-button export-btn"
        (click)="exportJson()"
        [disabled]="elements().length === 0"
      >
        üìÑ Export JSON
      </button>
      <button 
        class="action-button clear-btn"
        (click)="clearAll()"
        [disabled]="elements().length === 0"
      >
        üóëÔ∏è Clear All
      </button>
    </div>
  </div>

  @if (exportModalOpen()) {
    @if (exportArtifacts(); as artifacts) {
      <div class="export-modal-backdrop" (click)="closeExportModal()">
        <div class="export-modal" (click)="$event.stopPropagation()">
          <div class="export-modal__header">
            <h4>Export UI Artifacts</h4>
            <button type="button" class="export-modal__close" (click)="closeExportModal()">‚úñ</button>
          </div>
          <div class="export-modal__body">
            <section class="export-section">
              <div class="export-section__header">
                <h5>TypeScript Snippet</h5>
                <div class="export-section__actions">
                  <button type="button" (click)="copyExportContent('typescript')">Copy</button>
                  <button type="button" (click)="downloadExportContent('typescript')">Download</button>
                </div>
              </div>
              <pre class="export-section__code">{{artifacts.typescriptCode}}</pre>
            </section>
            <section class="export-section">
              <div class="export-section__header">
                <h5>Strings JSON</h5>
                <div class="export-section__actions">
                  <button type="button" (click)="copyExportContent('strings')">Copy</button>
                  <button type="button" (click)="downloadExportContent('strings')">Download</button>
                </div>
              </div>
              <pre class="export-section__code">{{artifacts.stringsJson}}</pre>
            </section>
          </div>
        </div>
      </div>
    }
  }
</div>