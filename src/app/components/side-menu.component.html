<div class="side-menu">
  <div class="menu-header">
    <h3>UI Builder</h3>
    <span class="menu-subtitle">Element library</span>
  </div>

  <!-- Add Element Section -->
  <div class="menu-section">
    <h4>Add Element</h4>
    <div class="element-types">
      @for (type of elementTypes; track type) {
        <button 
          class="element-type-btn"
          (click)="addElement(type)"
          [title]="'Add ' + type + (selectedElement() ? ' to ' + selectedElement()?.name : ' to root')"
        >
          <span class="element-icon">{{getElementIcon(type)}}</span>
          <span class="element-label">{{type}}</span>
        </button>
      }
    </div>
    @if (hasAdvancedPresets()) {
      <div class="advanced-presets">
        <button
          type="button"
          class="advanced-toggle-btn"
          (click)="toggleAdvancedPresetList()"
        >
          <span class="advanced-toggle-label">Advanced widgets</span>
          <span class="advanced-toggle-count">{{advancedPresets().length}}</span>
          <span class="advanced-toggle-icon">{{showAdvancedPresets() ? '‚ñ≤' : '‚ñº'}}</span>
        </button>
        @if (showAdvancedPresets()) {
          <div class="advanced-presets__list">
            @for (preset of advancedPresets(); track preset.id) {
              <button
                type="button"
                class="advanced-preset-btn"
                (click)="addAdvancedPreset(preset.id)"
                [title]="'Add ' + preset.label"
              >
                <div class="advanced-preset__header">
                  <span class="advanced-preset__label">{{preset.label}}</span>
                  @if (preset.category) {
                    <span class="advanced-preset__category">{{preset.category}}</span>
                  }
                </div>
                @if (preset.description) {
                  <span class="advanced-preset__description">{{preset.description}}</span>
                }
              </button>
            }
          </div>
        }
      </div>
    }
    <div class="add-info">
      @if (selectedElement(); as selected) {
        <span class="add-target">Adding to: <strong>{{selected.name}}</strong></span>
      } @else {
        <span class="add-target">Adding to: <strong>Root</strong></span>
      }
    </div>
  </div>

  <!-- Snapping -->
  <div class="menu-section">
    <h4>Snapping</h4>
    <div class="snap-toggle">
      <label class="snap-toggle__label">
        <input
          type="checkbox"
          [checked]="snapToElements()"
          (change)="setSnapToElements($any($event.target).checked)"
        />
        <span>Snap to nearby elements</span>
      </label>
      <p class="snap-toggle__hint">
        Aligns edges and centers while dragging elements within the same container.
      </p>
    </div>
  </div>

  <!-- Element Hierarchy -->
  <div class="menu-section">
    <h4>Element Hierarchy</h4>
    <div class="element-tree">
      @if (elements().length === 0) {
        <div class="empty-state">No elements yet</div>
      } @else {
        @for (item of getFlattenedElements(); track item.element.id) {
          <div class="tree-element" [class.selected]="item.element.id === selectedElementId()" [class.locked]="item.element.locked">
            <div 
              class="element-item"
              (click)="selectElement(item.element.id)"
              [style.padding-left.px]="item.level * 20"
            >
              <span class="child-indicator">{{getIndentIndicator(item.level)}}</span>
              <span class="element-icon">{{getElementIcon(item.element.type)}}</span>
              <span class="element-name">
                {{item.element.name}}
                @if (item.element.locked) {
                  <span class="element-lock-label">(Locked)</span>
                }
              </span>
              <div class="element-actions">
                <button
                  class="action-btn lock-btn"
                  (click)="toggleElementLock($event, item.element)"
                  [title]="item.element.locked ? 'Unlock element' : 'Lock element'"
                >
                  {{ item.element.locked ? 'üîì' : 'üîí' }}
                </button>
                <button
                  class="action-btn move-btn"
                  (click)="moveElement($event, item.element.id, 'up')"
                  [disabled]="!canMove(item.element, 'up')"
                  title="Move up"
                >‚¨ÜÔ∏è</button>
                <button
                  class="action-btn move-btn"
                  (click)="moveElement($event, item.element.id, 'down')"
                  [disabled]="!canMove(item.element, 'down')"
                  title="Move down"
                >‚¨áÔ∏è</button>
                <button 
                  class="action-btn delete-btn"
                  (click)="deleteElement($event, item.element.id)"
                  title="Delete element"
                >
                  üóëÔ∏è
                </button>
              </div>
            </div>
          </div>
        }
      }
    </div>
  </div>

  <!-- Actions -->
  <div class="menu-section">
    <h4>Actions</h4>
    <div class="actions">
      <button 
        class="action-button duplicate-btn"
        (click)="duplicateSelectedElement()"
        [disabled]="!selectedElementId()"
      >
        üìã Duplicate selected element
      </button>
      <button 
        class="action-button clear-btn"
        (click)="clearAll()"
        [disabled]="elements().length === 0"
      >
        üóëÔ∏è Clear All
      </button>
    </div>
  </div>
</div>