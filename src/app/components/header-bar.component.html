<header class="header-bar">
  <div class="brand">
    <span class="brand__title">UI Builder</span>
    <span class="brand__subtitle">Battlefield Portal</span>
  </div>

  <div class="background-controls">
    <div class="background-mode">
      <span class="background-mode__label">Canvas background:</span>
      <label class="mode-option">
        <input
          type="radio"
          name="canvas-background-mode"
          [checked]="backgroundMode() === 'black'"
          (change)="setBackgroundMode('black')"
        />
        <span class="mode-pill mode-pill--black">Black</span>
      </label>
      <label class="mode-option">
        <input
          type="radio"
          name="canvas-background-mode"
          [checked]="backgroundMode() === 'white'"
          (change)="setBackgroundMode('white')"
        />
        <span class="mode-pill mode-pill--white">White</span>
      </label>
      <label class="mode-option">
        <input
          type="radio"
          name="canvas-background-mode"
          [checked]="backgroundMode() === 'image'"
          (change)="setBackgroundMode('image')"
        />
        <span class="mode-pill mode-pill--image">Image</span>
      </label>

      @if (backgroundMode() === 'image') {
        <div class="background-image-controls">
          <label class="background-upload">
            <input
              class="background-upload__input"
              type="file"
              accept="image/*"
              multiple
              (change)="onBackgroundImageUpload($event)"
            />
            <span class="background-upload__icon">‚¨ÜÔ∏è</span>
            <span class="background-upload__text">Upload</span>
          </label>

          <div class="background-carousel">
            <button
              type="button"
              class="background-tile"
              [class.selected]="isBackgroundImageSelected(defaultBackgroundImage.id)"
              (click)="setBackgroundImage(defaultBackgroundImage.id)"
              [title]="defaultBackgroundImage.fileName"
            >
              <span class="background-tile__badge">Default</span>
              <span
                class="background-tile__preview"
                [style.background-image]="'url(' + defaultBackgroundImage.url + ')'"
              ></span>
              <span class="background-tile__label">{{ defaultBackgroundImage.label }}</span>
            </button>

            @for (image of backgroundImages(); track image.id) {
              <button
                type="button"
                class="background-tile"
                [class.selected]="isBackgroundImageSelected(image.id)"
                (click)="setBackgroundImage(image.id)"
                [title]="image.fileName"
              >
                <span
                  class="background-tile__preview"
                  [style.background-image]="'url(' + image.url + ')'"
                ></span>
                <span class="background-tile__label">{{ image.label }}</span>
              </button>
            }
          </div>

          @if (backgroundImages().length === 0) {
            <div class="background-empty">
              Uploaded images will appear here.
            </div>
          }
        </div>
      } @else {
        <div class="background-solid">
          <span
            class="solid-swatch"
            [class.solid-swatch--black]="backgroundMode() === 'black'"
            [class.solid-swatch--white]="backgroundMode() === 'white'"
          ></span>
          <span class="solid-label">{{ backgroundMode() | titlecase }} background active</span>
        </div>
      }
    </div>
  </div>

  <div class="header-actions">
    <button
      type="button"
      class="action-button"
      (click)="exportArtifactsToJson()"
      [disabled]="elements().length === 0"
      title="Export UI artifacts"
    >
      üìÑ Export UI
    </button>
  </div>
</header>

@if (exportModalOpen()) {
  @if (exportArtifacts(); as artifacts) {
    <div class="export-modal-backdrop" (click)="closeExportModal()">
      <div class="export-modal" (click)="$event.stopPropagation()">
        <div class="export-modal__header">
          <h4>Export UI Artifacts</h4>
          <button type="button" class="export-modal__close" (click)="closeExportModal()">‚úñ</button>
        </div>
        <div class="export-modal__body">
          <section class="export-section">
            <div class="export-section__header">
              <h5>TypeScript Snippet</h5>
              <div class="export-section__actions">
                <button type="button" (click)="copyExportContent('typescript')">Copy</button>
                <button type="button" (click)="downloadExportContent('typescript')">Download</button>
              </div>
            </div>
            <pre class="export-section__code">{{ artifacts.typescriptCode }}</pre>
          </section>
          <section class="export-section">
            <div class="export-section__header">
              <h5>Strings JSON</h5>
              <div class="export-section__actions">
                <button type="button" (click)="copyExportContent('strings')">Copy</button>
                <button type="button" (click)="downloadExportContent('strings')">Download</button>
              </div>
            </div>
            <pre class="export-section__code">{{ artifacts.stringsJson }}</pre>
          </section>
        </div>
      </div>
    </div>
  }
}
